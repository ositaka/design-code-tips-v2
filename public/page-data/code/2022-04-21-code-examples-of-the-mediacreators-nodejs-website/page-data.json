{
    "componentChunkName": "component---src-templates-code-post-js",
    "path": "/code/2022-04-21-code-examples-of-the-mediacreators-nodejs-website/",
    "result": {"data":{"markdownRemark":{"id":"f708efa8-62b3-5218-a6bb-8cdd65756c9d","html":"<h2>1 — Internet Connection Examples (<code>4g</code> + <code>3g</code>/<code>slow-2g</code>)</h2>\n<p>On this chapter we can find a few examples of code, tought to take the most advantage of the user's internet connection type. These connection types can vary from <code>4g</code>, <code>3g</code>, <code>2g</code> and <code>slow-2g</code>. For the sake of simplicity, we are going to ignore the <code>2g</code> one and use <code>slow-2g</code> instead, as it is the slowest internet connection (GPRS).</p>\n<p>Have in mind that, by default, Prismic already serves all the images with a rasonable quality/compression ratio. As a plus, it serves already all the images with a <code>.webp</code> and it converts <code>.gif</code> files to animated <code>.webp</code> files. The images end-up by having a good final file size served from Prismic.</p>\n<p>We use the <code>.pug</code> as template engine to make use of it's magic on serving dynamic data, with NodeJS. To achieve this, we set a JavaScript cookie on the <code>base.pug</code> file, after checking the user's connection type as the very beginning of the request. This \"internet connection check-test\" it runs every type the user navigates betwen pages.</p>\n<p>As a good example for this use case scenario is, for instance, on a indoor market, where the internet connection is not so good and it's changing quite frequently betwen <code>3g</code> and <code>slow-2g</code>. With this approach, we can quickly serve more compressed images, that will take less time to be loaded. This will give a better experience to the user and will keep the user motivated to wait a bit more, but not give it up. We show a background color on all images, based on its main color, picked by hand, to keep the branding aspect in mind.</p>\n<h3>1.1 — Video example (with Image fallback)</h3>\n<p>The desired element on this media object is the html element <code>&#x3C;video></code> and is only served when the <strong>user</strong> is on a <code>4g</code> connection. Case the user is on a bad connection type, for instance <code>3g</code> or <code>slow-2g</code>, an <code>&#x3C;img></code> html element will be served.</p>\n<h4>Notes</h4>\n<ol>\n<li>\n<p>in order to get even a better performance, and page load speed, we are using <code>.replace('?auto=compress,format', '?q=30')</code> to request a 70% optimized image, from the image processor of Prismic: <a href=\"https://prismic.io/blog/prismic-image-optimization-imgix\" title=\"See official post on Prismic.io\" target=\"_blank\" rel=\"noopener\"><code>imgix</code></a>.</p>\n</li>\n<li>\n<p>for desktop devices, is better to set a maximum size of 1200px wide, by using <code>&#x26;w=1200</code> at the end of the quality parameter fron the previous point.</p>\n</li>\n<li>\n<p>for mobile devices the default <code>width</code> of all the images are <strong>480px</strong>, because is heigher than the default 360px screen phone's width. This is helpful, because it serves a better image for high DPI screens, without the need for using a <code>@2x</code> image. In our case, the most important is the overall <a href=\"https://design-code.tips/tags/performance/\" target=\"_blank\" rel=\"noopener\">Performance of the website</a>.</p>\n</li>\n</ol>\n<h4>Example code — Video on <code>4g</code> only</h4>\n<pre class=\"grvsc-container abyss\" data-language=\"pug\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">figure</span><span class=\"mtk6\">.home__hero__media</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">picture</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15 mtki\">if</span><span class=\"mtk1\"> (connection </span><span class=\"mtk7\">===</span><span class=\"mtk1\"> </span><span class=\"mtk11\">&#39;4g&#39;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">video</span><span class=\"mtk1\">(</span><span class=\"mtk6\">preload</span><span class=\"mtk1\">=</span><span class=\"mtk11\">&quot;auto&quot;</span><span class=\"mtk1\"> </span><span class=\"mtk6\">playsinline</span><span class=\"mtk1\"> </span><span class=\"mtk6\">loop</span><span class=\"mtk1\"> </span><span class=\"mtk6\">muted</span><span class=\"mtk1\"> </span><span class=\"mtk6\">disablepictureinpicture</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk6\">srcset</span><span class=\"mtk1\">=</span><span class=\"mtk11\">`</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">          ${</span><span class=\"mtk1\">home.data.video[</span><span class=\"mtk4\">0</span><span class=\"mtk1\">].video_mobile.url</span><span class=\"mtk11\">} 768w,</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">          ${</span><span class=\"mtk1\">home.data.video[</span><span class=\"mtk4\">0</span><span class=\"mtk1\">].video_desktop.url</span><span class=\"mtk11\">} 769w</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">        `</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15 mtki\">else</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk15 mtki\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk7\">typeof</span><span class=\"mtk1\">(home.data.video[</span><span class=\"mtk4\">0</span><span class=\"mtk1\">].video_preview.phone) </span><span class=\"mtk7\">!==</span><span class=\"mtk1\"> </span><span class=\"mtk11\">&#39;undefined&#39;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">source</span><span class=\"mtk1\">(</span><span class=\"mtk6\">media</span><span class=\"mtk1\">=</span><span class=\"mtk11\">&#39;(max-width: 768px)&#39;</span><span class=\"mtk1\"> </span><span class=\"mtk6\">srcset</span><span class=\"mtk1\">=</span><span class=\"mtk11\">`${</span><span class=\"mtk1\">home.data.video[</span><span class=\"mtk4\">0</span><span class=\"mtk1\">].video_preview.phone.url.</span><span class=\"mtk6\">replace</span><span class=\"mtk1\">(</span><span class=\"mtk11\">&#39;?auto=compress,format&#39;</span><span class=\"mtk1\">, </span><span class=\"mtk11\">&#39;?q=30&#39;</span><span class=\"mtk1\">)</span><span class=\"mtk11\">}`</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk7\">source</span><span class=\"mtk1\">(</span><span class=\"mtk6\">media</span><span class=\"mtk1\">=</span><span class=\"mtk11\">&#39;(min-width: 769px)&#39;</span><span class=\"mtk1\"> </span><span class=\"mtk6\">srcset</span><span class=\"mtk1\">=</span><span class=\"mtk11\">`${</span><span class=\"mtk1\">home.data.video[</span><span class=\"mtk4\">0</span><span class=\"mtk1\">].video_preview.url.</span><span class=\"mtk6\">replace</span><span class=\"mtk1\">(</span><span class=\"mtk11\">&#39;?auto=compress,format&#39;</span><span class=\"mtk1\">, </span><span class=\"mtk11\">&#39;?q=30&amp;w=1200&#39;</span><span class=\"mtk1\">)</span><span class=\"mtk11\">}`</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">img</span><span class=\"mtk1\">(</span><span class=\"mtk6\">alt</span><span class=\"mtk1\">=home.data.video[</span><span class=\"mtk4\">0</span><span class=\"mtk1\">].video_preview.alt </span><span class=\"mtk6\">data-src</span><span class=\"mtk1\">=home.data.video[</span><span class=\"mtk4\">0</span><span class=\"mtk1\">].video_preview.url </span><span class=\"mtk6\">height</span><span class=\"mtk1\">=</span><span class=\"mtk11\">`${</span><span class=\"mtk1\">home.data.video[</span><span class=\"mtk4\">0</span><span class=\"mtk1\">].video_preview.dimensions.height</span><span class=\"mtk11\">}`</span><span class=\"mtk1\"> </span><span class=\"mtk6\">width</span><span class=\"mtk1\">=</span><span class=\"mtk11\">`${</span><span class=\"mtk1\">home.data.video[</span><span class=\"mtk4\">0</span><span class=\"mtk1\">].video_preview.dimensions.width</span><span class=\"mtk11\">}`</span><span class=\"mtk1\">)</span></span></span></code></pre>\n<h3>1.2 — Image example (<code>4g</code> vs <code>3g</code>/<code>slow-2g</code>)</h3>\n<p>Ideally, with <code>4g</code>, we serve a more sharped image (without any compression) and we use <code>.replace('?auto=compress,format', '')</code> to replace the default auto-compressed file from Prismic's CDN (with <a href=\"https://prismic.io/blog/prismic-image-optimization-imgix\" title=\"See official post on Prismic.io\" target=\"_blank\" rel=\"noopener\"><code>imgix</code></a>).</p>\n<p>If the user is on a bad connection (<code>3g</code> or <code>slow-2g</code>), we serve a 70% optimized image from the request to the Prismic CDN (with <a href=\"https://prismic.io/blog/prismic-image-optimization-imgix\" title=\"See official post on Prismic.io\" target=\"_blank\" rel=\"noopener\"><code>imgix</code></a>).</p>\n<h4>Example code — Sharper images on <code>4g</code></h4>\n<pre class=\"grvsc-container abyss\" data-language=\"pug\" data-index=\"1\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk7\">figure</span><span class=\"mtk6\">.home__projects__item__media</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">  </span><span class=\"mtk7\">picture</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15 mtki\">if</span><span class=\"mtk1\"> (</span><span class=\"mtk7\">typeof</span><span class=\"mtk1\">(project.project_image.phone) </span><span class=\"mtk7\">!==</span><span class=\"mtk1\"> </span><span class=\"mtk11\">&#39;undefined&#39;</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">source</span><span class=\"mtk1\">(</span><span class=\"mtk6\">media</span><span class=\"mtk1\">=</span><span class=\"mtk11\">&#39;(max-width: 768px)&#39;</span><span class=\"mtk1\"> </span><span class=\"mtk6\">srcset</span><span class=\"mtk1\">=</span><span class=\"mtk11\">`${</span><span class=\"mtk1\">connection </span><span class=\"mtk7\">===</span><span class=\"mtk1\"> </span><span class=\"mtk11\">&#39;4g&#39;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">?</span><span class=\"mtk1\"> project.project_image.phone.url </span><span class=\"mtk7\">:</span><span class=\"mtk1\"> project.project_image.phone.url.</span><span class=\"mtk6\">replace</span><span class=\"mtk1\">(</span><span class=\"mtk11\">&#39;?auto=compress,format&#39;</span><span class=\"mtk1\">, </span><span class=\"mtk11\">&#39;?q=30&#39;</span><span class=\"mtk1\">)</span><span class=\"mtk11\">}`</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">      </span><span class=\"mtk7\">source</span><span class=\"mtk1\">(</span><span class=\"mtk6\">media</span><span class=\"mtk1\">=</span><span class=\"mtk11\">&#39;(min-width: 769px)&#39;</span><span class=\"mtk1\"> </span><span class=\"mtk6\">srcset</span><span class=\"mtk1\">=</span><span class=\"mtk11\">`${</span><span class=\"mtk1\">connection </span><span class=\"mtk7\">===</span><span class=\"mtk1\"> </span><span class=\"mtk11\">&#39;4g&#39;</span><span class=\"mtk1\"> </span><span class=\"mtk7\">?</span><span class=\"mtk1\"> project.project_image.url.</span><span class=\"mtk6\">replace</span><span class=\"mtk1\">(</span><span class=\"mtk11\">&#39;?auto=compress,format&#39;</span><span class=\"mtk1\">, </span><span class=\"mtk11\">&#39;&#39;</span><span class=\"mtk1\">) </span><span class=\"mtk7\">:</span><span class=\"mtk1\"> project.project_image.url.</span><span class=\"mtk6\">replace</span><span class=\"mtk1\">(</span><span class=\"mtk11\">&#39;?auto=compress,format&#39;</span><span class=\"mtk1\">, </span><span class=\"mtk11\">&#39;?q=30&amp;w=1200&#39;</span><span class=\"mtk1\">)</span><span class=\"mtk11\">}`</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk7\">img</span><span class=\"mtk6\">.home__projects__item__media__image</span><span class=\"mtk1\">(</span><span class=\"mtk6\">alt</span><span class=\"mtk1\">=project.project_image.alt </span><span class=\"mtk6\">data-src</span><span class=\"mtk1\">=project.project_image.url.</span><span class=\"mtk6\">replace</span><span class=\"mtk1\">(</span><span class=\"mtk11\">&#39;?auto=compress,format&#39;</span><span class=\"mtk1\">, </span><span class=\"mtk11\">&#39;&#39;</span><span class=\"mtk1\">) </span><span class=\"mtk6\">height</span><span class=\"mtk1\">=</span><span class=\"mtk11\">`${</span><span class=\"mtk1\">project.project_image.dimensions.height</span><span class=\"mtk11\">}`</span><span class=\"mtk1\"> </span><span class=\"mtk6\">width</span><span class=\"mtk1\">=</span><span class=\"mtk11\">`${</span><span class=\"mtk1\">project.project_image.dimensions.width</span><span class=\"mtk11\">}`</span><span class=\"mtk1\">)</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span></code></pre>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .abyss { background-color: #000c18; }\n  .abyss .mtki { font-style: italic; }\n  .abyss .mtk7 { color: #225588; }\n  .abyss .mtk6 { color: #DDBB88; }\n  .abyss .mtk1 { color: #6688CC; }\n  .abyss .mtk15 { color: #9966B8; }\n  .abyss .mtk11 { color: #22AA44; }\n  .abyss .mtk4 { color: #F280D0; }\n  .abyss .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","frontmatter":{"date":"April 21, 2022","title":"Code Examples of the Media Creators (NodeJS) website\n","description":"Here is shown a few precious pieces of code, to help on the near future, when no one knows what this all is about.\n","tags":["Image Optimization","Internet Connections","JavaScript","NodeJS","Performance","Prismic.io","PugJS","Usability","User Experience","Video","Web Development"]}}},"pageContext":{"id":"f708efa8-62b3-5218-a6bb-8cdd65756c9d"}},
    "staticQueryHashes": ["4080856488"]}