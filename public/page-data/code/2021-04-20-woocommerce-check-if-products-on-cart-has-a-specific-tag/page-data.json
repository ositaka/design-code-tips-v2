{
    "componentChunkName": "component---src-templates-code-post-js",
    "path": "/code/2021-04-20-woocommerce-check-if-products-on-cart-has-a-specific-tag/",
    "result": {"data":{"markdownRemark":{"id":"1fd577e0-d2df-55bd-b538-1b884bf41611","html":"<h2>Check if products on cart have a specific tag: <code>#bottle-wine</code></h2>\n<p>I have been looking for a way of removing specific products if they can't be shipped to the customer country.</p>\n<p>Initially, I have come up with a long code with AJAX calls, but that solution was far from perfect. After a few months, I had to add a few more products like those ones and I had to sharpen the code I had before. After looking for new solutions, I have come up with the following one below.</p>\n<p>As you can see, I have mixed two different sources and finally got it working right.</p>\n<pre class=\"grvsc-container default-dark\" data-language=\"php\" data-index=\"0\"><code class=\"grvsc-code\"><span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\">/**</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"> * @snippet       Check if products on cart has a specific tag: #bottle-wine</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"> * @sourcecode    &lt;https://stackoverflow.com/questions/53346384/avoid-checkout-for-specific-products-on-specific-country-in-woocommerce&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"> * @sourcecode    &lt;https://stackoverflow.com/questions/48795558/disable-shipping-for-specific-products-based-on-country-in-woocommerce&gt;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk3\"> */</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk11\">add_action</span><span class=\"mtk1\">( </span><span class=\"mtk8\">&#39;woocommerce_before_calculate_totals&#39;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&#39;checking_and_removing_items&#39;</span><span class=\"mtk1\">, </span><span class=\"mtk7\">10</span><span class=\"mtk1\">, </span><span class=\"mtk7\">1</span><span class=\"mtk1\"> );</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk4\">function</span><span class=\"mtk1\"> </span><span class=\"mtk11\">checking_and_removing_items</span><span class=\"mtk1\">(</span><span class=\"mtk12\"> $cart</span><span class=\"mtk1\"> ) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">if</span><span class=\"mtk1\">( !</span><span class=\"mtk11\">is_checkout</span><span class=\"mtk1\">() &amp;&amp; !</span><span class=\"mtk11\">is_cart</span><span class=\"mtk1\">() ) </span><span class=\"mtk15\">return</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> ( </span><span class=\"mtk11\">is_admin</span><span class=\"mtk1\">() &amp;&amp; ! </span><span class=\"mtk11\">defined</span><span class=\"mtk1\">( </span><span class=\"mtk8\">&#39;DOING_AJAX&#39;</span><span class=\"mtk1\"> ) )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">if</span><span class=\"mtk1\"> ( </span><span class=\"mtk11\">did_action</span><span class=\"mtk1\">( </span><span class=\"mtk8\">&#39;woocommerce_before_calculate_totals&#39;</span><span class=\"mtk1\"> ) &gt;= </span><span class=\"mtk7\">2</span><span class=\"mtk1\"> )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">return</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">$customer_shipping_country</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">WC</span><span class=\"mtk1\">()-&gt;</span><span class=\"mtk12\">customer</span><span class=\"mtk1\">-&gt;</span><span class=\"mtk11\">get_shipping_country</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">if</span><span class=\"mtk1\">( </span><span class=\"mtk11\">empty</span><span class=\"mtk1\">(</span><span class=\"mtk12\">$customer_shipping_country</span><span class=\"mtk1\">) ){</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">$package</span><span class=\"mtk1\"> = </span><span class=\"mtk11\">WC</span><span class=\"mtk1\">()-&gt;</span><span class=\"mtk12\">shipping</span><span class=\"mtk1\">-&gt;</span><span class=\"mtk11\">get_packages</span><span class=\"mtk1\">()[</span><span class=\"mtk7\">0</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\">( ! </span><span class=\"mtk11\">isset</span><span class=\"mtk1\">(</span><span class=\"mtk12\">$package</span><span class=\"mtk1\">[</span><span class=\"mtk8\">&#39;destination&#39;</span><span class=\"mtk1\">][</span><span class=\"mtk8\">&#39;country&#39;</span><span class=\"mtk1\">]) ) </span><span class=\"mtk15\">return</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk12\">$customer_shipping_country</span><span class=\"mtk1\"> = </span><span class=\"mtk12\">$package</span><span class=\"mtk1\">[</span><span class=\"mtk8\">&#39;destination&#39;</span><span class=\"mtk1\">][</span><span class=\"mtk8\">&#39;country&#39;</span><span class=\"mtk1\">];</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// Only for NON BE customers</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">if</span><span class=\"mtk1\">( </span><span class=\"mtk12\">$customer_shipping_country</span><span class=\"mtk1\"> == </span><span class=\"mtk8\">&#39;BE&#39;</span><span class=\"mtk1\"> ) </span><span class=\"mtk15\">return</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk3\">// Iterate through each cart item</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk12\">$found</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">false</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">foreach</span><span class=\"mtk1\">( </span><span class=\"mtk12\">$cart</span><span class=\"mtk1\">-&gt;</span><span class=\"mtk11\">get_cart</span><span class=\"mtk1\">() as </span><span class=\"mtk12\">$cart_item_key</span><span class=\"mtk1\"> =&gt; </span><span class=\"mtk12\">$cart_item</span><span class=\"mtk1\"> )</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        </span><span class=\"mtk15\">if</span><span class=\"mtk1\">( </span><span class=\"mtk11\">has_term</span><span class=\"mtk1\">( </span><span class=\"mtk11\">array</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&#39;bottle-wine&#39;</span><span class=\"mtk1\">), </span><span class=\"mtk8\">&#39;product_tag&#39;</span><span class=\"mtk1\">, </span><span class=\"mtk12\">$cart_item</span><span class=\"mtk1\">[</span><span class=\"mtk8\">&#39;product_id&#39;</span><span class=\"mtk1\">] ) ) {</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">$found</span><span class=\"mtk1\"> = </span><span class=\"mtk4\">true</span><span class=\"mtk1\">;</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">            </span><span class=\"mtk12\">$cart</span><span class=\"mtk1\">-&gt;</span><span class=\"mtk11\">remove_cart_item</span><span class=\"mtk1\">( </span><span class=\"mtk12\">$cart_item_key</span><span class=\"mtk1\"> ); </span><span class=\"mtk3\">// remove item</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">        }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    </span><span class=\"mtk15\">if</span><span class=\"mtk1\">( </span><span class=\"mtk12\">$found</span><span class=\"mtk1\"> ){</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         </span><span class=\"mtk3\">// Custom notice</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         </span><span class=\"mtk11\">wc_clear_notices</span><span class=\"mtk1\">();</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">         </span><span class=\"mtk11\">wc_add_notice</span><span class=\"mtk1\">(</span><span class=\"mtk8\">&#39;Wine products are not shippable to your country and have been removed&#39;</span><span class=\"mtk1\">, </span><span class=\"mtk8\">&#39;error&#39;</span><span class=\"mtk1\">);</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">    }</span></span></span>\n<span class=\"grvsc-line\"><span class=\"grvsc-source\"><span class=\"mtk1\">}</span></span></span></code></pre>\n<p>Have in mind for this code to work, you have to add <code>#bottle-wine</code> (in this case) as a <strong>product tag</strong>.</p>\n<style class=\"grvsc-styles\">\n  .grvsc-container {\n    overflow: auto;\n    position: relative;\n    -webkit-overflow-scrolling: touch;\n    padding-top: 1rem;\n    padding-top: var(--grvsc-padding-top, var(--grvsc-padding-v, 1rem));\n    padding-bottom: 1rem;\n    padding-bottom: var(--grvsc-padding-bottom, var(--grvsc-padding-v, 1rem));\n    border-radius: 8px;\n    border-radius: var(--grvsc-border-radius, 8px);\n    font-feature-settings: normal;\n    line-height: 1.4;\n  }\n  \n  .grvsc-code {\n    display: table;\n  }\n  \n  .grvsc-line {\n    display: table-row;\n    box-sizing: border-box;\n    width: 100%;\n    position: relative;\n  }\n  \n  .grvsc-line > * {\n    position: relative;\n  }\n  \n  .grvsc-gutter-pad {\n    display: table-cell;\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  .grvsc-gutter {\n    display: table-cell;\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter::before {\n    content: attr(data-content);\n  }\n  \n  .grvsc-source {\n    display: table-cell;\n    padding-left: 1.5rem;\n    padding-left: var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem));\n    padding-right: 1.5rem;\n    padding-right: var(--grvsc-padding-right, var(--grvsc-padding-h, 1.5rem));\n  }\n  \n  .grvsc-source:empty::after {\n    content: ' ';\n    -webkit-user-select: none;\n    -moz-user-select: none;\n    user-select: none;\n  }\n  \n  .grvsc-gutter + .grvsc-source {\n    padding-left: 0.75rem;\n    padding-left: calc(var(--grvsc-padding-left, var(--grvsc-padding-h, 1.5rem)) / 2);\n  }\n  \n  /* Line transformer styles */\n  \n  .grvsc-has-line-highlighting > .grvsc-code > .grvsc-line::before {\n    content: ' ';\n    position: absolute;\n    width: 100%;\n  }\n  \n  .grvsc-line-diff-add::before {\n    background-color: var(--grvsc-line-diff-add-background-color, rgba(0, 255, 60, 0.2));\n  }\n  \n  .grvsc-line-diff-del::before {\n    background-color: var(--grvsc-line-diff-del-background-color, rgba(255, 0, 20, 0.2));\n  }\n  \n  .grvsc-line-number {\n    padding: 0 2px;\n    text-align: right;\n    opacity: 0.7;\n  }\n  \n  .default-dark {\n    background-color: #1E1E1E;\n    color: #D4D4D4;\n  }\n  .default-dark .mtk3 { color: #6A9955; }\n  .default-dark .mtk11 { color: #DCDCAA; }\n  .default-dark .mtk1 { color: #D4D4D4; }\n  .default-dark .mtk8 { color: #CE9178; }\n  .default-dark .mtk7 { color: #B5CEA8; }\n  .default-dark .mtk4 { color: #569CD6; }\n  .default-dark .mtk12 { color: #9CDCFE; }\n  .default-dark .mtk15 { color: #C586C0; }\n  .default-dark .grvsc-line-highlighted::before {\n    background-color: var(--grvsc-line-highlighted-background-color, rgba(255, 255, 255, 0.1));\n    box-shadow: inset var(--grvsc-line-highlighted-border-width, 4px) 0 0 0 var(--grvsc-line-highlighted-border-color, rgba(255, 255, 255, 0.5));\n  }\n</style>","frontmatter":{"date":"April 20, 2021","title":"WooCommerce: Check if products on cart have a specific tag, and remove them if they can't be shipped to the customer country\n","description":"Check if WooCommerce products on cart have a specific tag, for example \"Bottle-Wine\", and remove them if they can't be shipped to the customer country.\n","tags":["Web Development","PHP","WooCommerce"]}}},"pageContext":{"id":"1fd577e0-d2df-55bd-b538-1b884bf41611"}},
    "staticQueryHashes": ["4080856488"]}